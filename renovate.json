{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "packageRules": [
    {
      "description": "Auto-merge new PaperMC builds (safe), but NOT new Minecraft versions.",
      "matchDepNames": [
        "paper"
      ],
      "automerge": true
    }
  ],
  "customManagers": [
    {
      "description": "1. Track the base Minecraft Version",
      "customType": "regex",
      "managerFilePatterns": [
        "/^\\.build-ver$/"
      ],
      "matchStrings": [
        "# minecraft-version=(?<currentValue>[\\d\\.]+)\\n.*\\nCUSTOM_SERVER=.*"
      ],
      "depNameTemplate": "paper-version",
      "datasourceTemplate": "custom.paper-version",
      "autoReplaceStringTemplate": "# minecraft-version={{{newValue}}}\n# datasource=custom.papermc depName=paper\nCUSTOM_SERVER=https://api.papermc.io/v2/projects/paper/versions/{{{newValue}}}/builds/1/downloads/paper-{{{newValue}}}-1.jar",
      "versioningTemplate": "loose"
    },
    {
      "description": "2. Track the Build Number for the current Minecraft Version",
      "customType": "regex",
      "managerFilePatterns": [
        "/^\\.build-ver$/"
      ],
      "matchStrings": [
        "#\\s*datasource=(?<datasource>custom\\.papermc)\\s+depName=(?<depName>\\S+)\\nCUSTOM_SERVER=https://api\\.papermc\\.io/v2/projects/paper/versions/(?<packageName>[\\d\\.]+)/builds/(?<currentValue>\\d+)/downloads/.*"
      ],
      "autoReplaceStringTemplate": "# datasource={{{datasource}}} depName={{{depName}}}\nCUSTOM_SERVER=https://api.papermc.io/v2/projects/paper/versions/{{{packageName}}}/builds/{{{newValue}}}/downloads/paper-{{{packageName}}}-{{{newValue}}}.jar",
      "versioningTemplate": "loose"
    }
  ],
  "customDatasources": {
    "paper-version": {
      "defaultRegistryUrlTemplate": "https://api.papermc.io/v2/projects/paper",
      "format": "json",
      "transformTemplates": [
        "{ \"releases\": versions.{ \"version\": $ } }"
      ]
    },
    "papermc": {
      "defaultRegistryUrlTemplate": "https://api.papermc.io/v2/projects/paper/versions/{{packageName}}",
      "format": "json",
      "transformTemplates": [
        "{ \"releases\": builds.{ \"version\": $string($) } }"
      ]
    }
  }
}
